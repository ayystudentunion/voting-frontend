<div class="page-header">
  <h1 translate>
    pages.vote.page_title
  </h1>
</div>

<div
  class="jumbotron alert alert-danger"
  ng-if="vote.loadError"
  translate-namespace="pages.vote.error">

  <div class="container">
    <h1 translate>
      .something_went_wrong
    </h1>

    <p translate>
      .could_not_load_candidates
    </p>

    <p translate>
      .request_a_new_link_and_try_again
    </p>

    <a
      ng-href="#/sign-up"
      class="btn btn-primary"
      translate>
      .button_request_link
    </a>
  </div>
</div>

<div
  class="row"
  translate-namespace="pages.vote">

  <div class="col-xs-12">

    <form
      novalidate
      ng-hide="vote.loadError">

      <div> <!-- required container for set-class-when-at-top -->
        <div
          class="panel panel-primary vote-ballot"
          set-class-when-at-top="fix-to-top"
          padding-when-at-top="10">
          <!-- N.B. padding-when-at-top must match the fixed position px,
               otherwise a jumpy side-effect will occurr -->

          <div class="panel-heading">
            <h3 class="panel-title" translate>.vote-ballot.title</h3>
          </div>

          <div class="panel-body">
            <span
              ng-hide="vote.isProspectSelected()"
              translate>
              .vote-ballot.ingress
            </span>

            <vote-prospect
              ng-show="vote.isProspectSelected()"
              vt-selected="vote.selected"
              vt-all="vote.candidates">
            </vote-prospect>

            <div
              ng-if="vote.isUnsaved()"
              class="alert alert-warning">

              <p translate>
                .vote-ballot.about-to-change-existing-vote
              </p>
            </div>

          </div>

          <div class="panel-footer">
            <button
              class="btn btn-primary"
              ng-click="vote.submit(vote.selected)"
              ng-disabled="!vote.isProspectSelected() || vote.submitting || vote.submitted"
              ng-hide="vote.submitted"
              >

                <div ng-show="vote.submitting && !vote.submitted">
                  <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>
                  <span translate>.vote-ballot.submitting</span>
                </div>

                <div
                  ng-hide="vote.submitting || vote.submitted || vote.submitError"
                  translate>
                  .vote-ballot.button-submit-caption
                </div>
            </button>

            <div
              class="alert alert-success"
              role="alert"
              ng-if="vote.submitted && !vote.submitError">

              <p>
                <strong translate>.vote-has-been-cast</strong>
              </p>

              <p>
                <span translate>.if-you-are-eligible-in-others</span>
                <a ng-href="#/elections" translate>.choose-next-election</a>.
              </p>

              <p translate>
                .close-window-when-finished
              </p>
            </div>

            <div
              class="alert alert-danger"
              role="alert"
              ng-if="vote.submitError">
              <strong>Äänestäminen epäonnistui!</strong>
              <p>
                Lataa äänestyssivu uudelleen selaimen
                refresh-toiminnolla ja yritä äänestää uudelleen.
              </p>
              <p>
                Jos ongelma toistuu, ota yhteys HYYn vaalityöntekijään
                HYYn vaalityöntekijään vaalit@hyy.fi
                +358 50 551 6147
              </p>
            </div>

          </div>
        </div>
      </div>

      <div ng-if="vote.loading">
        <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>
      </div>

      <div ng-if="!vote.loading">

        <!-- SEARCH -->
        <div class="form-horizontal">
          <h2 translate>.search.title</h2>
          <!--
          <div class="form-group">
            <label for="candidateNumber" class="col-sm-3 control-label">Numero</label>
            <div class="col-sm-8">
              <input class="form-control" ng-model="vote.candidate.number">
            </div>
          </div>
          -->

          <div class="form-group">
            <label
              for="candidateName"
              class="col-sm-3 control-label"
              translate>
              .search.candidate-name
            </label>

            <div class="col-sm-8">
              <input class="form-control" ng-model="vote.candidate.name">
            </div>

          </div>
        </div>

        <!-- ALLIANCES -->
        <div
          ng-repeat="a in vote.alliances"
          ng-show="filteredCandidates.length"
          >

          <h1 ng-bind="a.name"></h1>

          <!-- CANDIDATES OF ALLIANCE -->
          <table class="table table-striped table-hover">
            <thead>
              <th></th>
              <th translate>.search.header-number</th>
              <th translate>.search.header-candidate</th>
            </thead>

            <tbody>
              <tr
                ng-repeat="c in filteredCandidates = (a.candidates | filter:vote.candidate)"
                ng-class="{ 'info': vote.selected == c.id }"
                >

                <td>
                <label>
                  <input
                    type="radio"
                    ng-disabled="vote.submitting || vote.submitted"
                    ng-model="vote.selected"
                    ng-value="c.id">
                  </td>
                  <td ng-click="vote.select(c)">{{ c.number }}</td>
                  <td ng-click="vote.select(c)">{{ c.name }}</td>
                </label>
              </tr>
            </td>
          </table>

        </div>

      </div> <!-- /loading -->

    </form>

  </div> <!-- col -->
</div> <!-- row -->
